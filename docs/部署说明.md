# 部署说明
## `AutoBangumi` 环境变量说明
| 环境变量                     | 作用                         | 参数               |
| ------------------------ |----------------------------|------------------|
| `TZ`                     | 时区                         | `Asia/Shanghai`  |
| `AB_INTERVAL_TIME`       | 间隔时间                       | `1800`           |
| `AB_DOWNLOADER_HOST`     | qBittorrent 的地址和端口号        | `localhost:8080` |
| `AB_DOWNLOADER_USERNAME` | qBittorrent 的用户名           | `admin`          |
| `AB_DOWNLOADER_PASSWORD` | qBittorrent 的密码            | `adminadmin`     |
| `AB_METHOD`              | 重命名方法                      | `pn`             |
| `AB_GROUP_TAG`           | 是否在下载规则中添加组名               | `False`          |
| `AB_DOWNLOAD_PATH`       | qBittorrent 中的下载路径         | 必填项              |
| `AB_RSS`                 | RSS 订阅地址                   | 必填项              |
| `AB_NOT_CONTAIN`         | 输入想要过滤的元素                  | `720`            |
| `AB_RULE_DEBUG`          | RSS 解析器 debug 模式           | `False`          |
| `AB_DEBUG_MODE`          |                            | `Fasle`          |
| `AB_EP_COMPLETE`         | 历史番剧下载                     | `False`          |
| `AB_SEASON_ONE`| 开启后如果没有 Season 信息自动添加为 S01 | `True`           |
| `AB_REMOVE_BAD_BT`| 碰到无法重命名的合集等，自动删除种子         | `False`          |
## 在 Linux 主机中使用 Docker-Compose 一键部署
现在提供了一键部署的 `AutoBangumi` 的方法，可以使用 `docker-compose.yml` 文件进行部署。
### [安装 Docker](https://docs.docker.com/get-docker/)
### [安装 Docker-Compose](https://docs.docker.com/compose/)
    
正常来说安装完 Docker 之后都会自带 Docker-Compose，使用命令：
```bash
docker-compose -v
```
检查版本即可
### 部署 `AutoBangumi`
    
项目中提供了三种安装方式：
- 只安装 `AutoBangumi`
    ```bash
    wget https://raw.githubusercontent.com/EstrellaXD/Auto_Bangumi/main/docs/docker-compose/AutoBangumi/docker-compose.yml
    ```
- 安装 `qBittorrent`与`AutoBangumi`
    ```bash
    wget https://raw.githubusercontent.com/EstrellaXD/Auto_Bangumi/main/docs/docker-compose/qBittorrent+AutoBangumi/docker-compose.yml
    ```
- `qBittorrent`+`AutoBangumi`+`Plex`
    ```bash
    wget https://raw.githubusercontent.com/EstrellaXD/Auto_Bangumi/main/docs/docker-compose/All-in-one/docker-compose.yml
    ```

1. 首先选择你要安装的方式，**拷贝上面的命令运行即可**，这一步是下载 `docker-compose` 配置文件，如果需要自定义可以使用文本编辑器对其中的参数进行自定义。

2. **定义环境变量**
    ```shell
    export \
    DOWNLOAD_PATH=/path/downloads \
    RSS=<RSS_LINK> \
    QB_PORT=<YOUR_PORT>
    ```
- `DOWNLOAD_PATH`: 写你的下载文件保存的地方：
  - 如果已经部署过 qBittorrent 这里请填写相对路径，比如：`/downloads/Bangumi`
  - 如果是部署合集，请填写想要下载的绝对路径： `/home/NAS/downloads`
- `RSS`: 填写你的[蜜柑计划](https://mikanani.me)订阅地址:

    ![image.png](https://github.com/EstrellaXD/Auto_Bangumi/blob/main/docs/image/截屏2022-06-05%2018.13.31.png?raw=true)

- `QB_PORT`: 填写你的已经部署的 qBittorrent 端口号，或者想要自定义的端口号，比如: `8080`

3. **拉起 Docker-Compose**
    ```bash
    docker-compose up
    ```
4. 如果想要自定义参数，可以参考文章最开头的说明进行自定义

## 使用 `Docker-cli` 部署
```shell
docker run -d \
  --name=AutoBangumi \
  -e AB_DOWNLOAD_PATH=/path/downloads \
  -e AB_RSS=<YOUR_RSS_ADDRESS> \
  --network=host \
  --dns=8.8.8.8 \
  --restart unless-stopped \
  estrellaxd/auto_bangumi:latest
```
推荐使用 *[Portainer](https://www.portainer.io)* 等带有 UI 的 Docker 管理器进行进阶部署

## 群晖部署说明（ QNAP 同理）

## 部署结果：
```other
2022-06-05 16:38:49 INFO: Add RSS Feed successfully.
2022-06-05 16:38:50 INFO: Adding Kawaii dake ja Nai Shikimori-san Season 1
2022-06-05 16:38:50 INFO: Adding Kakkou no Iinazuke Season 1
2022-06-05 16:38:50 INFO: Adding SPYxFAMILY Season 1
2022-06-05 16:38:50 INFO: Adding Love Live！虹咲学园 学园偶像同好会 Season 2
2022-06-05 16:38:50 INFO: Adding CUE! Season 1
2022-06-05 16:38:50 INFO: Adding Kaguya-sama wa Kokurasetai Season 3
2022-06-05 16:38:50 INFO: Adding Shokei Shoujo no Virgin Road Season 1
2022-06-05 16:38:50 INFO: Adding Kakkou no Iikagen Season 1
2022-06-05 16:38:50 INFO: Adding Summer Time Rendering Season 1
2022-06-05 16:38:50 INFO: Adding Mahoutsukai Reimeiki Season 1
2022-06-05 16:38:50 INFO: Adding Paripi Koumei Season 1
2022-06-05 16:38:50 INFO: Adding Komi-san wa, Komyushou Desu. Season 1
2022-06-05 16:38:50 INFO: Adding Deaimon Season 1
2022-06-05 16:38:50 INFO: Adding Tate no Yuusha no Nariagari Season 2
2022-06-05 16:38:50 INFO: Adding Shijou Saikyou no Daimaou Season 1
2022-06-05 16:38:50 INFO: Adding Yuusha, Yamemasu Season 1
2022-06-05 16:38:50 INFO: Adding Tomodachi Game Season 1
2022-06-05 16:38:50 INFO: Adding Machikado Mazoku: 2-choume Season 1
2022-06-05 16:38:50 INFO: Start collecting past episodes.
2022-06-05 16:39:32 INFO: Start adding rules.
2022-06-05 16:39:32 INFO: Finished.
2022-06-05 16:39:32 INFO: Waiting for downloading torrents...
2022-06-05 16:49:32 INFO: Finished checking 185 file's name.
2022-06-05 16:49:32 INFO: Renamed 0 files.
2022-06-05 16:49:32 INFO: Finished rename process.
```

## [错误排查](https://github.com/EstrellaXD/Auto_Bangumi/blob/main/docs/常见错误解决.md)
**出现错误请先检查文档再提问！**